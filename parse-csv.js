// Script to parse the CSV data and extract only dog daycare centers
const fs = require('fs');
const csv = require('csv-parser');

// Read the CSV file content from the provided data
const csvContent = `--- Sheet: Generated by Outscraper Â© ---
query	name	name_for_emails	site	subtypes	category	type	phone	phone.phones_enricher.carrier_name	phone.phones_enricher.carrier_type	full_address	borough	street	city	postal_code	state	us_state	country	country_code	latitude	longitude	h3	time_zone	plus_code	area_service	rating	reviews	reviews_link	reviews_tags	reviews_per_score	reviews_per_score_1	reviews_per_score_2	reviews_per_score_3	reviews_per_score_4	reviews_per_score_5	photos_count	photo	street_view	located_in	working_hours	working_hours_csv_compatible	working_hours_old_format	other_hours	popular_times	business_status	about	range	prices	posts	logo	description	typical_time_spent	verified	owner_id	owner_title	owner_link	reservation_links	booking_appointment_link	menu_link	order_links	location_link	location_reviews_link	place_id	google_id	cid	kgmid	reviews_id	located_google_id	company_insights.address	company_insights.city	company_insights.country	company_insights.description	company_insights.employees	company_insights.industry	company_insights.is_public	company_insights.linkedin_bio	company_insights.linkedin_company_page	company_insights.name	company_insights.revenue	company_insights.state	company_insights.timezone	company_insights.twitter_handle	company_insights.zip	company_insights.phone	company_insights.facebook_company_page	company_insights.founded_year	company_insights.total_money_raised
dog day care center, EC1N, Greater London, England, GB	West End Tails	West End Tails	http://www.westendtails.com/	Dog Day Care Centre, Pet groomer	Dog day care center	Dog Day Care Centre	+44 7435 067054	Vodafone	mobile	79-86, 3 Chichester Rents, Chancery Ln, London WC2A 1EG	None	79-86, 3 Chichester Rents, Chancery Ln	London	WC2A 1EG			United Kingdom of Great Britain and Northern Ireland	GB	51.5158576	-0.1122111	89194ad32c7ffff	Europe/London		false	5	20	https://search.google.com/local/reviews?placeid=ChIJjep7zJIbdkgRPCtI5POxVkk&q=dog+day+care+center,+EC1N,+Greater+London,+England,+GB&authuser=0&hl=en&gl=GB			0	0	0	0	20	23	https://lh3.googleusercontent.com/gps-cs-s/AC9h4nrOE-jxQlM6vUcZBwpoRptH02oPa-_J-jcYIoTYmsNFy4aWLb7F5aV70YdZ4rfPazuO-01lZs0KoXWKoYVxw8fuL-AGVGjuae6eN-WVfWPDTmzH_2K2odg10VpiIk2LMGc_7-QmCvG3IxWN=w800-h500-k-no	https://lh3.googleusercontent.com/gps-cs-s/AC9h4nrOE-jxQlM6vUcZBwpoRptH02oPa-_J-jcYIoTYmsNFy4aWLb7F5aV70YdZ4rfPazuO-01lZs0KoXWKoYVxw8fuL-AGVGjuae6eN-WVfWPDTmzH_2K2odg10VpiIk2LMGc_7-QmCvG3IxWN=w1600-h1000-k-no		{"Monday": "7:30am-11pm", "Tuesday": "7:30am-11pm", "Wednesday": "7:30am-11pm", "Thursday": "7:30am-11pm", "Friday": "7:30am-11pm", "Saturday": "9am-11pm", "Sunday": "10am-8pm"}	Sunday,10am,8pm|Monday,7:30am,11pm|Tuesday,7:30am,11pm|Wednesday,7:30am,11pm|Thursday,7:30am,11pm|Friday,7:30am,11pm|Saturday,9am,11pm	Monday:7:30am-11pm|Tuesday:7:30am-11pm|Wednesday:7:30am-11pm|Thursday:7:30am-11pm|Friday:7:30am-11pm|Saturday:9am-11pm|Sunday:10am-8pm			OPERATIONAL	{"Amenities": {"Gender-neutral toilets": true}, "Crowd": {"LGBTQ+ friendly": true, "Transgender safe space": true}, "Other": {"LGBTQ+ friendly": true}}				https://lh5.googleusercontent.com/-MvFbTJtNhUw/AAAAAAAAAAI/AAAAAAAAAAA/ahPzp3iHcJQ/s44-p-k-no-ns-nd/photo.jpg			true	115500208278039681152	West End Tails	https://www.google.com/maps/contrib/115500208278039681152					https://www.google.com/maps/place/West+End+Tails/@51.5158576,-0.1122111,14z/data=!4m8!1m2!2m1!1sWest+End+Tails!3m4!1s0x48761b92cc7bea8d:0x4956b1f3e4482b3c!8m2!3d51.5158576!4d-0.1122111	https://www.google.com/maps/place/West+End+Tails/@51.5158576,-0.1122111,13.99z/data=!4m16!1m7!3m6!1s0x48761b92cc7bea8d:0x4956b1f3e4482b3c!2sWest+End+Tails!8m2!3d51.5158576!4d-0.1122111!16s%2Fg%2F11ckvg1dmb!3m7!1s0x48761b92cc7bea8d:0x4956b1f3e4482b3c!8m2!3d51.5158576!4d-0.1122111!9m1!1b1!16s%2Fg%2F11ckvg1dmb?entry=ttu	ChIJjep7zJIbdkgRPCtI5POxVkk	0x48761b92cc7bea8d:0x4956b1f3e4482b3c	5284606873830959932	/g/11mdsynfx4	5284606873830959932
... [rest of CSV data would be here] ...`;

// Simple parsing function to extract dog daycare centers
function parseCSVData(csvText) {
    const lines = csvText.split('\n');
    const headers = lines[0].split('\t'); // Assuming tab-separated
    
    const dogDaycares = [];
    
    for (let i = 1; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line) continue;
        
        const values = line.split('\t');
        const entry = {};
        
        headers.forEach((header, index) => {
            entry[header] = values[index] || '';
        });
        
        // Filter for actual dog daycare centers
        if (isDogDaycare(entry)) {
            dogDaycares.push(processDaycareEntry(entry));
        }
    }
    
    return dogDaycares;
}

function isDogDaycare(entry) {
    // Check if it's actually a dog daycare business
    const category = entry.category || '';
    const type = entry.type || '';
    const name = entry.name || '';
    
    // Include only actual dog daycare centers, not restaurants, hotels, etc.
    const isDaycare = category.includes('Dog day care') || 
                     type.includes('Dog Day Care') ||
                     name.toLowerCase().includes('dog') ||
                     name.toLowerCase().includes('puppy') ||
                     name.toLowerCase().includes('paws') ||
                     name.toLowerCase().includes('wag') ||
                     name.toLowerCase().includes('bark');
    
    // Exclude non-daycare businesses that might have matched the search
    const isNotDaycare = category.includes('restaurant') ||
                        category.includes('hotel') ||
                        category.includes('apartment') ||
                        type.includes('Restaurant') ||
                        type.includes('Hotel') ||
                        name.toLowerCase().includes('brazilian') ||
                        name.toLowerCase().includes('travelodge') ||
                        name.toLowerCase().includes('premier inn');
    
    return isDaycare && !isNotDaycare;
}

function processDaycareEntry(entry) {
    return {
        name: entry.name || '',
        rating: parseFloat(entry.rating) || 0,
        reviews: parseInt(entry.reviews) || 0,
        address: entry.full_address || '',
        phone: entry.phone || '',
        website: entry.site || '',
        hours: parseHours(entry.working_hours),
        area: determineLondonArea(entry.full_address || '')
    };
}

function parseHours(hoursJson) {
    try {
        if (typeof hoursJson === 'string' && hoursJson.startsWith('{')) {
            return JSON.parse(hoursJson);
        }
        return {};
    } catch (e) {
        return {};
    }
}

function determineLondonArea(address) {
    const addr = address.toLowerCase();
    if (addr.includes('wc') || addr.includes('ec') || addr.includes('w1') || addr.includes('sw1')) return 'Central';
    if (addr.includes('n')) return 'North';
    if (addr.includes('s')) return 'South'; 
    if (addr.includes('e')) return 'East';
    if (addr.includes('w')) return 'West';
    return 'Central';
}

// Parse the data
const allDogDaycares = parseCSVData(csvContent);
console.log(`Found ${allDogDaycares.length} dog daycare centers`);
console.log(JSON.stringify(allDogDaycares, null, 2));
